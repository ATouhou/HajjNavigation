
								var p1 = {id: routing_points[0], lat: json[routing_points[0]].lat, lon: json[routing_points[0]].lon};
								var p2 = {id: routing_points[1], lat: json[routing_points[1]].lat, lon: json[routing_points[1]].lon};
								
								var haram = new L.LatLng(21.42356843900675, 39.8257827758789);
								var arafat = new L.LatLng(21.355497536856447, 39.977874755859375);

								var res;
								
								if((routing_markers[0].getLatLng().distanceTo(haram) < 416 && routing_markers[1].getLatLng().distanceTo(haram) < 416)
								|| (routing_markers[0].getLatLng().distanceTo(arafat) < 3013 && routing_markers[1].getLatLng().distanceTo(arafat) < 3013)
								|| (routing_markers[0].getLatLng().distanceTo(arafat) < 3013 && routing_markers[1].getLatLng().distanceTo(arafat) < 3013)){
									res = [];
								}
								else
									res = do_search(routing_type, p1, p2);
								//console.log(res);
								if(typeof(res) === 'undefined'){
									alert("No routs found!");
									route = 1;
								}
								else{
									res.push([routing_markers[0].getLatLng().lat, routing_markers[0].getLatLng().lng]);
									res.unshift([routing_markers[1].getLatLng().lat, routing_markers[1].getLatLng().lng]);
									route = L.polyline(res, {color: 'blue'}).addTo(map);
								}
								change_state("NONE");
							}
						}
					} 
					else if(state == "ADD_POI"){
						add_new_poi(e.latlng.lat, e.latlng.lng);
						
						change_state("NONE");
					}
					else{
					}
				}

				map.on('click', onMapClick);
				Hammer(document.getElementById('map')).on('hold', function(e){
					var containerPoint = map.mouseEventToContainerPoint(e.gesture.center),
						layerPoint = map.containerPointToLayerPoint(containerPoint),
						latlng = map.layerPointToLatLng(layerPoint);
					here_popup
						.setLatLng(latlng)
						.setContent(latlng.toString() + "<br />" + "<input type='button' style='width: 100%; height: 100%; font-size: 8px' value='Route to Here' onclick='route_to_pos(" + latlng.lat + ", " + latlng.lng + ")' />")
						.openOn(map);
				});
				
				$(".msDropDown").msDropDown({height: 100});
				
				$("#POI_img_edit").click(function(){
					/*var popover = new CameraPopoverOptions(300, 300, 100, 100, Camera.PopoverArrowDirection.ARROW_ANY);*/
					var options = {
						quality         : 70,
						targetWidth     : 200,
						targetHeight    : 200,
						sourceType      : Camera.PictureSourceType.SAVEDPHOTOALBUM,
						destinationType : Camera.DestinationType.DATA_URL,
						encodingType    : Camera.EncodingType.JPEG
					};
					navigator.camera.getPicture(function(imgData){
						$("#POI_img_edit").css('background-image', 'url(data:image/jpeg;base64,' + imgData + ')');
					}, function(error){
						alert('Failed: ' + error);
					}, options);
				});
			});

			
			</script>
			<div id="poi_window" style='position: fixed; top: 0px; left: 0px; bottom: 0px; right: 0px; background-color: white; z-index: 1001; display: none;'>
			<input type="hidden" id="id" />
			<input type="hidden" id="lat" />
			<input type="hidden" id="lon" />
			<table style="width: 100%; height: 100%;">
				<tr>
					<td style="width: 50%; vertical-align: top;">
						<table style="width: 100%;">
							<tr>
								<td style="width: 100px;">Type</td>
							</tr>
							<tr>
								<td style="padding: 5px">
									<select id="poi_type" class='msDropDown' style='width: 100%;'>
										<option value='Disable Ramp'      data-description='' data-image='images/poi/Disable Ramp.png'>Disable Ramp</option>
										<option value='Haram Entrances'   data-description='' data-image='images/poi/Haram Entrances.png'>Haram Entrances</option>
										<option value='Hotels'            data-description='' data-image='images/poi/Hotels.png'>Hotels</option>
										<option value='Medical'           data-description='' data-image='images/poi/Medical.png'>Medical</option>
										<option value='Mosques'           data-description='' data-image='images/poi/Mosques.png'>Mosques</option>
										<option value='Place of Interest' data-description='' data-image='images/poi/Place of Interest.png'>Place of Interest</option>
										<option value='Resturants'        data-description='' data-image='images/poi/Resturants.png'>Resturants</option>
										<option value='Services Center'   data-description='' data-image='images/poi/Services Center.png'>Services Center</option>
										<option value='Shopping'          data-description='' data-image='images/poi/Shopping.png'>Shopping</option>
										<option value='Toilet'            data-description='' data-image='images/poi/Toilet.png'>Toilet</option>
										<option value='Transport'         data-description='' data-image='images/poi/Transport.png'>Transport</option>
										<option value='Wudu'              data-description='' data-image='images/poi/Wudu.png'>Wudu</option>
										<option value='Zam - Zam'         data-description='' data-image='images/poi/Zam - Zam.png'>Zam - Zam</option>
									</select>
								</td>
							</tr>
							<tr>
								<td>Name</td>
							</tr>
							<tr>
								<td style="padding: 5px"><input id="poi_name" type="text" style="width: 100%" /></td>
							</tr>
							<tr>
								<td>Description</td>
							</tr>
							<tr>
								<td style="padding: 5px"><textarea id="poi_desc" rows=4 style="width: 100%; resize: none"></textarea></td>
							</tr>
						</table>
					</td>
					<td id="POI_img_edit" rowspan=2 style="width: 50%; background-color: #EEE; text-align: center; color: #AAA; padding: 10px; background-size: contain; background-repeat: no-repeat; background-position: center center;">
						Tap to change image
					</td>
				</tr>
				<tr>
					<td style="vertical-align: bottom; text-align: center">
						<table style="width: 100%; height: 40px;">
							<tr>
								<td style="width: 33%">
									<input type="button" value="OK" style="width: 100%; height: 100%" onclick="save_poi(); close_poi_edit();" />
								</td>
								<td style="width: 33%">
									<input type="button" value="Delete" style="width: 100%; height: 100%" onclick="delete_poi_edit();" />
								</td>
								<td style="width: 33%">
									<input type="button" value="Cancel" style="width: 100%; height: 100%" onclick="close_poi_edit();" />
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			</div>
			<script>
				function create_poi_list_item(id, lat, lon, title, text, type, img){
					return "<table onclick=\"$('#manage_poi_window').fadeOut('fast'); map.setView(["+lat+", "+lon+"], map.getZoom()); lst_poi["+id+"].openPopup();\" style=\"width: 200px; height: 80px; margin: 5px; display: inline-block; font-size: 10px; border: 1px solid #EEE; background-color: #FAFAFA; border-radius: 10px; padding: 5px; box-shadow: 1px 1px 4px 0px #AAA;\"><tr><td rowspan=3 style=\"width: 80px; height: 75px; background-color: #EEE; background-image: "+img+"; background-repeat: no-repeat; background-size: contain; background-position: center center;\"></td><td style=\"width: 120px\"><b>"+title+"</b></td></tr><tr><td>"+type+"</td></tr><tr style=\"height: 100%; vertical-align: top\"><td>"+text+"</td></tr></table>";
				}
				
				function load_poi_list_items(q){
					var query = "";
					if(q != ''){
						query = "WHERE [title] LIKE '%" + q + "%' ";
						query += "OR [text] LIKE '%" + q + "%' ";
						query += "OR [type] LIKE '%" + q + "%' ";
					}

					document.getElementById('poi_list_td').innerHTML = "";
					db.transaction(function(tx){
						tx.executeSql("SELECT [id], [lat], [lon], [type], [title], [text], [image] FROM POI " + query, [], function(tx, result){
							for(var i=0;i<result.rows.length;i++){
								var s_id    = result.rows.item(i).id;
								var s_lat   = result.rows.item(i).lat;
								var s_lon   = result.rows.item(i).lon;
								var s_type  = result.rows.item(i).type;
								var s_title = result.rows.item(i).title;
								var s_text  = result.rows.item(i).text;
								var s_image = result.rows.item(i).image;
								var elem = create_poi_list_item(s_id, s_lat, s_lon, s_title, s_text, s_type, s_image);
								document.getElementById('poi_list_td').innerHTML += elem;
							}
						});
					});
				}
			</script>
			
			<table id="manage_poi_window" style='position: fixed; top: 0px; left: 0px; bottom: 0px; right: 0px; background-color: white; z-index: 1001; display: none; width: 100%; height: 100%'>
				<tr>
					<td colspan=2 style="height: 50px;">
						<h2 style="text-align: center;">Managing POIs</h2>
					</td>
				</tr>
				<tr style="height: 30px;">
					<td>
						<input type="text" id="query" /><input type="button" value="Search" onclick="load_poi_list_items($('#query').val());" />
					</td>
					<td style="text-align: right;">
						<input type="button" value="Add new POI" onclick="$('#manage_poi_window').fadeOut('fast'); change_state('ADD_POI', 'Click on the map ');" />
					</td>
				</tr>
				<tr style="vertical-align: top;">
					<td colspan=2 style="height: calc(100% - 110px)">
						<div id="poi_list_td" style="height: 100%; width: 100%;overflow-y: scroll; overflow-x: hidden;">

						</div>
					</td>
				</tr>
				<tr style="height: 30px;">
					<td colspan=2>
						<input type="button" value="Back" style="width: 100%; height: 40px;" onclick="$('#manage_poi_window').fadeOut('fast');" />
					</td>
				</tr>
			</table>
		</div>
	</body>
</html>
